{ "resource": { "aws_iam_role": { "preprocess-input_role": { "name": "swipe-dev-preprocess-input", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "process-stage-output_role": { "name": "swipe-dev-process-stage-output", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "handle-success_role": { "name": "swipe-dev-handle-success", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "handle-failure_role": { "name": "swipe-dev-handle-failure", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "swipe-dev-process-batch-event_role": { "name": "swipe-dev-swipe-dev-process-batch-event", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "swipe-dev-process-sfn-event_role": { "name": "swipe-dev-swipe-dev-process-sfn-event", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "report_metrics_role": { "name": "swipe-dev-report_metrics", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" }, "report_spot_interruption_role": { "name": "swipe-dev-report_spot_interruption", "assume_role_policy": "{\"Version\": \"2012-10-17\", \"Statement\": [{\"Sid\": \"\", \"Effect\": \"Allow\", \"Principal\": {\"Service\": \"lambda.amazonaws.com\"}, \"Action\": \"sts:AssumeRole\"}]}" } }, "aws_iam_role_policy": { "preprocess-input_role": { "name": "preprocess-input_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.preprocess-input_role.id}" }, "process-stage-output_role": { "name": "process-stage-output_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.process-stage-output_role.id}" }, "handle-success_role": { "name": "handle-success_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.handle-success_role.id}" }, "handle-failure_role": { "name": "handle-failure_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.handle-failure_role.id}" }, "swipe-dev-process-batch-event_role": { "name": "swipe-dev-process-batch-event_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.swipe-dev-process-batch-event_role.id}" }, "swipe-dev-process-sfn-event_role": { "name": "swipe-dev-process-sfn-event_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.swipe-dev-process-sfn-event_role.id}" }, "report_metrics_role": { "name": "report_metrics_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.report_metrics_role.id}" }, "report_spot_interruption_role": { "name": "report_spot_interruption_rolePolicy", "policy": "{\"Version\": \"2012-10-17\", \"Statement\": []}", "role": "${aws_iam_role.report_spot_interruption_role.id}" } }, "aws_lambda_function": { "preprocess-input": { "function_name": "swipe-dev-preprocess-input", "runtime": "python3.6", "handler": "app.preprocess_input", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.preprocess-input_role.arn}" }, "process-stage-output": { "function_name": "swipe-dev-process-stage-output", "runtime": "python3.6", "handler": "app.process_stage_output", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.process-stage-output_role.arn}" }, "handle-success": { "function_name": "swipe-dev-handle-success", "runtime": "python3.6", "handler": "app.handle_success", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.handle-success_role.arn}" }, "handle-failure": { "function_name": "swipe-dev-handle-failure", "runtime": "python3.6", "handler": "app.handle_failure", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.handle-failure_role.arn}" }, "swipe-dev-process-batch-event": { "function_name": "swipe-dev-swipe-dev-process-batch-event", "runtime": "python3.6", "handler": "app.process_batch_event", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.swipe-dev-process-batch-event_role.arn}" }, "swipe-dev-process-sfn-event": { "function_name": "swipe-dev-swipe-dev-process-sfn-event", "runtime": "python3.6", "handler": "app.process_sfn_event", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.swipe-dev-process-sfn-event_role.arn}" }, "report_metrics": { "function_name": "swipe-dev-report_metrics", "runtime": "python3.6", "handler": "app.report_metrics", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.report_metrics_role.arn}" }, "report_spot_interruption": { "function_name": "swipe-dev-report_spot_interruption", "runtime": "python3.6", "handler": "app.report_spot_interruption", "memory_size": 256, "tags": { "managedBy": "chalice", "project": "swipe", "aws-chalice": "version=1.26.0:stage=dev:app=swipe" }, "timeout": 600, "source_code_hash": "${filebase64sha256(\"${path.module}/deployment.zip\")}", "filename": "${path.module}/deployment.zip", "environment": { "variables": { "RunSPOTMemoryDefault": "128000", "RunEC2MemoryDefault": "128000" } }, "role": "${aws_iam_role.report_spot_interruption_role.arn}" } }, "aws_cloudwatch_event_rule": { "swipe-dev-process-batch-event-event": { "name": "swipe-dev-process-batch-event-event", "event_pattern": "{\"source\": [\"aws.batch\"], \"detail\": {\"status\": [\"RUNNABLE\"]}}" }, "swipe-dev-process-sfn-event-event": { "name": "swipe-dev-process-sfn-event-event", "event_pattern": "{\"source\": [\"aws.states\"]}" }, "report_metrics-event": { "name": "report_metrics-event", "schedule_expression": "rate(1 minute)", "description": "" }, "report_spot_interruption-event": { "name": "report_spot_interruption-event", "event_pattern": "{\"source\": [\"aws.ec2\"], \"detail\": {\"type\": [\"EC2 Spot Instance Interruption Warning\"]}}" } }, "aws_cloudwatch_event_target": { "swipe-dev-process-batch-event-event": { "rule": "${aws_cloudwatch_event_rule.swipe-dev-process-batch-event-event.name}", "target_id": "swipe-dev-process-batch-event-event", "arn": "${aws_lambda_function.swipe-dev-process-batch-event.arn}" }, "swipe-dev-process-sfn-event-event": { "rule": "${aws_cloudwatch_event_rule.swipe-dev-process-sfn-event-event.name}", "target_id": "swipe-dev-process-sfn-event-event", "arn": "${aws_lambda_function.swipe-dev-process-sfn-event.arn}" }, "report_metrics-event": { "rule": "${aws_cloudwatch_event_rule.report_metrics-event.name}", "target_id": "report_metrics-event", "arn": "${aws_lambda_function.report_metrics.arn}" }, "report_spot_interruption-event": { "rule": "${aws_cloudwatch_event_rule.report_spot_interruption-event.name}", "target_id": "report_spot_interruption-event", "arn": "${aws_lambda_function.report_spot_interruption.arn}" } }, "aws_lambda_permission": { "swipe-dev-process-batch-event-event": { "function_name": "${aws_lambda_function.swipe-dev-process-batch-event.arn}", "action": "lambda:InvokeFunction", "principal": "events.amazonaws.com", "source_arn": "${aws_cloudwatch_event_rule.swipe-dev-process-batch-event-event.arn}" }, "swipe-dev-process-sfn-event-event": { "function_name": "${aws_lambda_function.swipe-dev-process-sfn-event.arn}", "action": "lambda:InvokeFunction", "principal": "events.amazonaws.com", "source_arn": "${aws_cloudwatch_event_rule.swipe-dev-process-sfn-event-event.arn}" }, "report_metrics-event": { "function_name": "${aws_lambda_function.report_metrics.arn}", "action": "lambda:InvokeFunction", "principal": "events.amazonaws.com", "source_arn": "${aws_cloudwatch_event_rule.report_metrics-event.arn}" }, "report_spot_interruption-event": { "function_name": "${aws_lambda_function.report_spot_interruption.arn}", "action": "lambda:InvokeFunction", "principal": "events.amazonaws.com", "source_arn": "${aws_cloudwatch_event_rule.report_spot_interruption-event.arn}" } } }, "terraform": { "required_version": "> 0.11.0, < 1.1.0"
  },
  "provider": {
    "template": {
      "version": "~> 2"
    },
    "aws": {
      "version": ">= 2, < 4"
    },
    "null": {
      "version": ">= 2, < 4"
    }
  },
  "data": {
    "aws_caller_identity": {
      "chalice": {}
    },
    "aws_partition": {
      "chalice": {}
    },
    "aws_region": {
      "chalice": {}
    },
    "null_data_source": {
      "chalice": {
        "inputs": {
          "app": "swipe",
          "stage": "dev"
        }
      }
    }
  }
}
